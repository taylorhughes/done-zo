var DNZO={load:function(B){var A=$("switcher");if(A){A.observe("change",DNZO.onSwitchList)}$$("a.dialog").each(function(C){new ModalDialog(C)});DNZO.verifyTimezone()},onSwitchList:function(A){document.location.href=$F(A.element())},verifyTimezone:function(){if(typeof TimezoneInfo=="undefined"||TimezoneInfo.updateUrl.length==0){return}var A=(new Date()).getTimezoneOffset();if(TimezoneInfo.offset!=A){new Ajax.Request(TimezoneInfo.updateUrl,{parameters:{offset:A},method:"post"})}}};Event.observe(window,"load",DNZO.load);ModalDialog=Class.create({initialize:function(B,A){if(B.match("a")){this.href=B.href;this.method="get"}else{if(B.match("input")){var C=B.up("form");this.href=C.action;this.method=C.method}}B.observe("click",this.onClickShow.bind(this));this.createElements();this.options=A||{}},createElements:function(){if(this.blackout){this.blackout.remove()}this.blackout=new Element("div");this.blackout.addClassName("blackout");this.blackout.setStyle({position:"absolute",display:"none",background:"black"});if(this.container){this.container.remove()}this.container=new Element("div");this.container.addClassName("dialog_container");var B=new Element("div");B.addClassName("loading");this.container.appendChild(B);this.container.setStyle({position:"absolute",display:"none"});var A=$("body");A.appendChild(this.blackout);A.appendChild(this.container)},position:function(){var C=this.container.getDimensions();var B=document.viewport.getScrollOffsets();var A=document.viewport.getDimensions();var E=(A.height/4)-(C.height/4)+B.top;var D=(A.width/2)-(C.width/2)+B.left;this.blackout.setStyle({top:B.top+"px",left:B.left+"px",width:"100%",height:"100%"});this.container.setStyle({left:D+"px",top:E+"px"})},onClickShow:function(A){A.stop();this.show()},onClickHide:function(A){A.stop();this.hide()},onScroll:function(A){this.position()},show:function(){if(this.effecting){return}if(!this.isLoaded){this.load()}this.effecting=true;this.boundOnScroll=this.onScroll.bind(this);Event.observe(window,"scroll",this.boundOnScroll);this.position();new Effect.Parallel([new Effect.Appear(this.blackout,{from:0,to:0.2,sync:true}),new Effect.Appear(this.container,{sync:true})],{duration:0.25,afterFinish:this.doShow.bind(this)})},doShow:function(){this.effecting=false;this.afterShown()},afterShown:function(){if(!this.isLoaded){return}if(this.options.afterShown){this.options.afterShown()}},load:function(){if(!this.isLoading){new Ajax.Request(this.href,{method:this.method,onSuccess:this.doLoad.bind(this),afterComplete:(function(A){this.isLoading=false}).bind(this)})}},doLoad:function(A){this.container.innerHTML=A.responseText;this.container.select(".hide_dialog").each((function(B){B.observe("click",this.onClickHide.bind(this))}).bind(this));this.position();this.isLoaded=true;this.afterShown()},hide:function(){if(this.effecting){return}this.effecting=true;if(this.boundOnScroll){Event.stopObserving(window,"scroll",this.boundOnScroll);this.boundOnScroll=null}new Effect.Parallel([new Effect.Fade(this.blackout,{sync:true}),new Effect.Fade(this.container,{sync:true})],{duration:0.25,afterFinish:(function(){this.effecting=false}).bind(this)})}});