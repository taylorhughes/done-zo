{% extends "layouts/logged_in.html" %}

{% load tasks_library %}

{% block page_title %}DNZO / {{ task_list.name }}{% if filter_title %} / {{ filter_title }}{% endif %}{% endblock %}

{% block javascripts %}
  {% javascript_tag dnzo/tasks %}
{% endblock %}

{% block header %}
  {% if filter_title %}<a href="{% url tasks.views.list_index task_list.short_name %}">{% endif %}
  {{ task_list.name }}{% if filter_title %}</a> / {{ filter_title }}{% endif %}
{% endblock %}

{% block content %}
<style type="text/css">
  {% if user.hide_project %}
  th.project, td.project { display: none; }
  {% endif %}
  {% if user.hide_contexts %}
  th.context, td.context { display: none; }
  {% endif %}
  {% if user.hide_due_date %}
  th.due, td.due { display: none; }
  {% endif %}
</style>

<table cellspacing="0" cellpadding="0" id="tasks_list">
  <tr>
    {% sorting_header "<img src=\"/images/checkmark.gif\" alt=\"checkmark\">" "complete" order direction "done" %}
    {% sorting_header "Project" "project_index" order direction "project" %}
    {% sorting_header "Task" "body" order direction "task" %}
    <th class="context"><span>Context</span></th>
    {% sorting_header "Due" "due_date" order direction "due" %}
  </tr>
  {% for task in tasks %}
    {% include "tasks/tasks/task.html" %}
  {% endfor %}
  <tr id="add_row">
    <td></td>
    <td colspan="6"><a id="add" href="{% url tasks.views.task %}" style="text-decoration:underline; color:#369">Add task</a></td>
  </tr>
</table>

{% if tasks|length_is:max_records %}
<p>Results limited to {{ max_records }} items.</p>
{% endif %}

<form method="POST" id="tasks_form" action="{% url tasks.views.task %}?task_list={{task_list.short_name}}">
  <table id="new_task_table">
  {% with new_task as task %}
    {% include "tasks/tasks/task.html" %}
  {% endwith %}
  </table>
</form>
{% endblock %}

{% block footer %}
<form action="{% url tasks.views.purge_list task_list.short_name %}" method="POST">
<p id="archive">
    <input type="submit" value="Archive completed tasks">&nbsp;
</p>
</form>

<div id="new-delete">
{% if not task_lists|length_is:1 %}
<p><a href="{% url tasks.views.delete_list task_list.short_name %}">Delete list</a></p>
{% endif %}
<form action="{% url tasks.views.add_list %}" method="GET">
  <input type="submit" value="Add list" id="add_list">&nbsp;
</form>
</div>
{% endblock %}